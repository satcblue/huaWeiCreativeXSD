### 字符串表达式功能概述

字符串表达式用于解析和操作字符串，返回结果为字符串类型。相较于数值表达式，字符串表达式无法进行数值计算，但可以作为字符串相关函数的参数使用。其功能包括字符串的拼接、子串提取、查找、替换、格式化等操作。字符串表达式仅支持嵌套字符串函数、字符串、字符串变量和数值型变量。

### 应用场景

1. **节日图片显示**：根据不同的节日显示对应的图片。
2. **动态内容生成**：根据用户输入或其他变量动态生成文本内容。

### 表达式支持的操作

**基本运算**：
- **字符串拼接（+）**：如 `@a + 'hello' + @b` 将拼接变量`@a`、字符串`hello`和变量`@b`。

**支持的函数**：

- **substr(原字符串, 开始位置, 长度)**：返回指定位置和长度的子串。
    - 例：`substr('你好呀', 1, 2)` 返回 `'好呀'`（索引从0开始）。

- **strIsEmpty(str)**：判断字符串是否为空。
    - 例：`strIsEmpty(@abc)` 如果`@abc`为空返回`'true'`，否则返回`'false'`。

- **strIndexOf(str1, str2)**：查找`str2`在`str1`中首次出现的位置。
    - 例：`strIndexOf('hello', 'he')` 返回 `'0'`。

- **strLastIndexOf(str1, str2)**：查找`str2`在`str1`中最后出现的位置。
    - 例：`strLastIndexOf('hello', 'l')` 返回 `'3'`。

- **strContains(str1, str2)**：判断`str1`是否包含`str2`。
    - 例：`strContains('hello', 'he')` 返回 `'true'`。

- **strReplaceAll(str1, str2, str3)**：将`str1`中的所有`str2`替换为`str3`。
    - 例：`strReplaceAll('hello', 'e', 'i')` 返回 `'hillo'`。

- **preciseeval(str, 数值/数值型变量)**：计算表达式的值并保留指定的小数位数。
    - 例：`preciseeval('1/3', 3)` 返回 `'0.333'`。

- **formatDate('format', @time_sys)**：返回指定格式的当前系统时间。
    - 例：`formatDate('yyyy-MM-dd hh:mm:ss', @time_sys)` 返回 `'2024-01-22 16:52:00'`。

- **plus(a, b)**：返回a和b的和（整数值）。
    - 例：`plus(3, 3)` 返回 `'6'`。

- **ifelse(x1, y1, x2, y2, ..., xn, yn, z)**：条件判断，从x1开始判断，若存在xi不等于0，则返回yi，否则返回z。
    - 例：`ifelse(eq(#click_count, 5), 'Yes', 'No')` 如果点击次数为5，返回`'Yes'`，否则返回`'No'`。

### XML规范支持

- 支持数组：如 `@string[expression]`，索引支持表达式解析。
- 支持数值和字符串型的全局变量解析：如 `#num`，`@str`。
    - 注意：如果需要在字符串表达式中进行数值计算，不能以`#num`开头。
    - 正确示例：`10*#num`

### 示例表达式

1. **拼接字符串**：
   ```xml
   @name + '，欢迎你！今天是 ' + formatDate('yyyy年MM月dd日', @time_sys)
   ```
   如果`@name`为`'小明'`，当前系统时间为`2024年01月22日`，则返回`'小明，欢迎你！今天是 2024年01月22日'`。

2. **字符串包含判断**：
   ```xml
   strContains('hello world', 'world')
   ```
   返回`'true'`。

3. **字符串替换**：
   ```xml
   strReplaceAll('hello world', 'world', 'everyone')
   ```
   返回`'hello everyone'`。

4. **条件判断**：
   ```xml
   ifelse(eq(#click_count, 5), '点击次数为5', '点击次数不为5')
   ```
   如果点击次数为5，返回`'点击次数为5'`，否则返回`'点击次数不为5'`。

以上为字符串表达式的功能说明及应用示例，可以根据具体需求在表达式中嵌套使用不同的函数和变量，以实现复杂的字符串操作和逻辑判断。